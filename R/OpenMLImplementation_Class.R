#' @title Construct OpenMLImplementation.
#'
#' @param id [\code{integer(1)}]\cr
#'   ID of the implementation. Generated by the server, based on name and version of the implementation.
#'   Ignored when uploaded manually.
#' @param uploader [\code{integer(1)}]\cr
#'   The user that uploaded the implementation. Added by the server. Ignored when uploaded manually.
#' @param name [\code{character(1)}]\cr
#'   The name of the implementation. Name-version combinations should be unique.\cr 
#'   Allowed characters: () [] a-z A-Z 0-9 . _ - +
#' @param version [\code{character(1)}]\cr
#'   The version of the implementation.\cr 
#'   Allowed characters: () [] a-z A-Z 0-9 . _ - +
#' @param description [\code{character(1)}]\cr
#'   A user description of the implementation.
#' @param creator [\code{character}]\cr
#'   Optional. The persons/institutions that created the implementation.
#' @param contributor [\code{character}]\cr
#'   Optional. (Minor) contributors to the workflow
#' @param upload.date [\code{characte(1)r}]\cr
#'   The date on which the implementation was uploaded.\cr
#'   Format YYYY-mm-ddThh:MM:SS. 
#'   Added by the server. Ignored when uploaded manually.
#' @param licence [\code{character(1)}]\cr
#'   Optional. Default is none, meaning Public Domain or "don't know/care".
#' @param language [\code{character(1)}]\cr
#'   Optional. Starts with one upper case letter, rest is lower case. Default is English.
#' @param full.description [\code{character(1)}]\cr
#'   Optional. Full description of the workflow, e.g, man pages filled in by tool. 
#'   This is a much more elaborate description than given in the 'description field'. It may include
#'   information about all components of the workflow.
#' @param installation.notes [\code{character(1)}]\cr
#'   Optional. Additional hints on how to run the implementation.
#' @param dependencies [\code{character(1)}]\cr
#'   The dependencies of the implementation.
#' @param bibliographical.reference [\code{list}]\cr
#'   An optional list containing information on bibliographical references in form of
#'   \code{\link{OpenMLBibRef}s}.
#'  # @param implements [\code{character}]\cr
#'  #   Ontological reference.
#' @param parameter [\code{list}]\cr
#'   The parameters of the implementation. A list containing 
#'   \code{\link{OpenMLImplementationParameter}s}.
#' @param components [\code{list}]\cr
#'   A list contatining \code{\link{OpenMLImplementation}s}. Typically components of a workflow or 
#'   subfunctions of an algorithm (e.g. kernels). Components can have their own parameters.
#' @param source.url [\code{character(1)}]\cr
#'   URL from which the source code can be downloaded. Added by the server. Ignored when uploaded manually.
#' @param binary.url [\code{character(1)}]\cr
#'   URL from which the binary can be downloaded. Added by the server. Ignored when uploaded manually.
#' @param source.format [\code{character(1)}]\cr
#'   Format of the source file.
#' @param binary.format [\code{character(1)}]\cr
#'   Format of the binary file.
#' @param source.md5 [\code{character(1)}]\cr
#'   MD5 checksum to check if the source code was uploaded correctly.
#' @param binary.md5 [\code{character(1)}]\cr
#'   MD5 checksum to check if the binary code was uploaded correctly.
#' @export
#' @aliases OpenMLImplementation 
makeOpenMLImplementation = function(
  id = NA_integer_,
  uploader = NA_integer_,
  name,
  version = NA_character_,
  external.version = NA_character_,
  description,
  creator = NA_character_,
  contributor = NA_character_,
  upload.date = NA_character_,
  licence = NA_character_,
  language = "English",
  full.description = NA_character_,
  installation.notes = NA_character_,
  dependencies = NA_character_,
  bibliographical.reference = NULL,
  # implements = NA_character_,
  parameter = NULL,
  components = NULL,
  source.url = NA_character_,
  binary.url = NA_character_,
  source.format = NA_character_,
  binary.format = NA_character_,
  source.md5 = NA_character_,
  binary.md5 = NA_character_
  ) {
  
  assertInt(id)
  assertInt(uploader)
  assertString(name)
  assertString(version, na.ok = TRUE)
  assertString(external.version, na.ok = TRUE)
  assertString(description)
  assertCharacter(creator)
  assertCharacter(contributor)
  assertString(upload.date, na.ok = TRUE)
  assertString(licence, na.ok = TRUE)
  assertString(language)
  assertString(full.description, na.ok = TRUE)
  assertString(installation.notes, na.ok = TRUE)
  assertString(dependencies, na.ok = TRUE)
  if (!is.null(bibliographical.reference))
    assertList(bibliographical.reference)
  if (!is.null(parameter))
    assertList(parameter)
  if (!is.null(components))
    assertList(components)
  assertString(source.url, na.ok = TRUE)
  assertString(binary.url, na.ok = TRUE)
  assertString(source.format, na.ok = TRUE)
  assertString(binary.format, na.ok = TRUE)
  assertString(source.md5, na.ok = TRUE)
  assertString(binary.md5, na.ok = TRUE)
  
  makeS3Obj("OpenMLImplementation",
    id = id,
    uploader = uploader,
    name = name,
    version = version,
    external.version = external.version,
    description = description,
    creator = creator,
    contributor = contributor,
    upload.date = upload.date,
    licence = licence,
    language = language,
    full.description = full.description,
    installation.notes = installation.notes,
    dependencies = dependencies,
    bibliographical.reference = bibliographical.reference,
    #implements = implements,
    parameter = parameter,
    components = components,
    source.url = source.url,
    binary.url = binary.url,
    source.format = source.format,
    binary.format = binary.format,
    source.md5 = source.md5,
    binary.md5 = binary.md5  
  )
}

# ***** Methods *****

# show
#' @export
print.OpenMLImplementation = function(x, ...)  {
  catNotNA = function(s, val) {
    if (!is.na(val)) 
      catf("%s %s", s, val)
  }
  
  ## General implementation info
  catf('\n** Implementation Information **')
  
  catNotNA('ID               :: ', x$id)
  catNotNA('Name             :: ', x$name)
  catNotNA('OpenML Version   :: ', x$version)
  catNotNA('External Version :: ', x$external.version)
  
  ## Authors and contributors
  if (length(x$creator) > 0) {
    cat('\nCreator(s)     :: ')
    cat(collapse(x$creator, sep = ", "))
  }
  if (length(x$contributor) > 0) {
    cat('\nContributor(s) :: ')
    cat(collapse(x$contributor, sep = ", "))
  }
  
  ## Other info
  catf('\nDate :: %s', x$upload.date)
  #catNotEmpty('Licence :: ', x$licence)
  #catNotEmpty('Language :: ', x$language)
  
  ## Implementation specific info
  catf('\n\nDescription of the implementation :')
  catf(x$description)
  
  #FIXME: We need to reimplement these lines.
  #catNotEmpty('Full description :: ', x$full.description)
  #catNotEmpty('Installation notes :: ', x$installation.notes)
  #catNotEmpty('Dependencies :: ', collapse(x$dependencies, ", "))
  #catNotEmpty('\nProgramming language :: ',x$programming.language)
  #catNotEmpty('\nOperating system :: ',x$operating.system)
  
  ## Bibliographic info
  #if (x$bib.citation != "")
  #  catf('\nBibliographic citation :: ',x$bib.citation)
  #if (x$bib.url != "")
  #  catf('\nBibliographic URL :: ',x$bib.url)
  
  ## More implementation details
  #if (x$implements != "")
  #  catf('\nImplements :: ',x$implements)
 
  ## Implementation parameters
  if (length(x$parameter)) {
    catf('\nImplementation parameters :\n')
    for(i in 1:length(x$parameter)) 
      print(x$parameter[i])
  }
  
  ## Implementation components
  if (length(x$components)) {
    catf('\nDescription of Implementation Components ::')
    print(x$components)
  }
  
  ## Bibliographical references
  if (length(x$bibliographical.reference) > 0) {
    catf("Bibliographical Reference(s):")
    for(i in 1:length(x$bibliographical.reference)) 
      print(x$bibliographical.reference[[i]])  
  }
  ## The implementation source information
  #catNotEmpty('Source URL :: ', x$source.url)
  #catNotEmpty('Binary URL :: ', x$binary.url)
  #catNotEmpty('Source format :: ', x$source.format)
  #catNotEmpty('Binary format :: ', x$binary.format)
  #catNotEmpty('Source MD5 :: ', x$source.md5)
  #catNotEmpty('Binary MD5 :: ', x$binary.md5)
  #cat('\n\n')
}
  

