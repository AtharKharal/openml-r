---
title: "OpenML"
author: "The OpenML R Team"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{OpenML}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r init, include=FALSE}
# library("knitr")
# opts_chunk$set(cache = TRUE)
library("OpenML")
setOMLConfig(apikey = "c1994bdb7ecb3c6f3c8f3b35f4b47f1f")
```

# Uploading {#upload}
The following section gives an overview on how one can contribute building blocks (i.e. data sets, flows and runs) to the OpenML server.

## Upload a data set 
A data set contains information that can be stored on OpenML and used by OpenML tasks and runs. In this example, a very simple (and admittedly rather stupid) data set is created, processed with `mlr` and uploaded to the OpenML server. The corresponding workflow of uploading a data sets consists of the following four steps:

1. `make*Task`: create a task (e.g. `makeClassifTask` for classification tasks)
2. `makeOMLDataSetDescription`: create the description object of an OpenML data set
3. `makeOMLDataSet`: convert this task to an OpenML data set
4. `uploadOMLDataSet`: upload the data set to the server

```{r eval = FALSE, warning = FALSE, message = TRUE} 

## This is a fake meaningless data set. Please DO NOT upload it to the server!
days = c(1, 10, 5)
startdate = c('2016-02-10', '2016-02-11', '2016-02-21')
task = c('Write code', 'Test', 'Make documentation')
project = data.frame(task, days, startdate)

## Create a new mlr classification task
sample.task = makeClassifTask(id = "my_project", data = project,
  target = "task", weights = NULL, blocking = NULL, positive = NA_character_,
  fixup.data = "warn", check.data = TRUE) 

## create a new OML data set from the mlr task
sampleOMLDataSet = makeOMLDataSet(desc = data.description, data = project, 
  colnames.old = colnames(project), colnames.new = colnames(project), 
  target.features = "task") 

(**FIXME: UPLOADING DOES NOT WORK WITH READ_ONLY KEY**)

## upload a data set to the server
dataset.id = uploadOMLDataSet(sample.task)
dataset.id
```

## Upload a flow using mlr

A flow is an implementation of a single algorithm or a script. To create a flow, we can use the `mlr` package, which already contains numerous implemented algorithms. Each `mlr` learner can be considered as an implementation of a flow, which then again can be uploaded to the server with the function `uploadOMLFlow`.
If the flow has already been uploaded to the server, one receives a message that the flow already exists and the `flow.id` is returned from the function.
Otherwise, the not existing flow is uploaded and a new `flow.id` is assigned to it.
 
```{r eval = FALSE, warning = FALSE, message = TRUE}
library(mlr)
lrn = makeLearner("classif.randomForest")
flow.id = uploadOMLFlow(lrn)
flow.id
```

## Upload a flow without using mlr

(**??? Fixme: We don't want to do this with the sourcefile anymore. Should we provide a link how to create a mlr-learner as alternative?**)
In the previous section, we explained how to create an `OMLFlow` manually and created the object `oml.flow`, which reflects the description object of the flow. Before one can upload the flow to the server, one has to store the algorithm (that should be used as a flow) within a single R-script. Assuming one has already done this step (and the path to the R-script is called `"path-to-sourcefile"`), one can can now upload the flow as follows:


```{r eval = FALSE}
oml.flow.id = uploadOMLFlow(oml.flow, sourcefile = "path-to-sourcefile")
oml.flow.id
```

## Upload an OpenML run to the server

In addition to uploading data sets or flows, one can also upload runs. Runs that have been created using `mlr` can be uploaded by:
```{r eval = FALSE, warning = FALSE, message = TRUE}
run.id = uploadOMLRun(run.mlr)
```
Before the run is uploaded, `uploadOMLRun` is checking whether the flow that created this run is available on the server. If the flow is not available on the server, it will also be uploaded (automatically).
(**??? Fixme: Cannot be executed with read-only API key. I still would like to execute this in order to check the code...**)
